<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-CA"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Convert standard module code into an R package — convertToPackage • SpaDES.core</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Convert standard module code into an R package — convertToPackage"><meta property="og:description" content="EXPERIMENTAL – USE WITH CAUTION. This function attempts to convert a
SpaDES module to the closest rendition of the same functionality, but in an
R package. The main change is that instead of SpaDES.core parsing the functions
using custom parsing tools, it will use pkgload::load_all on the package functions.
These"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-58633549-6"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58633549-6');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.core</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/i-introduction.html">01 Introduction to `SpaDES`</a>
    </li>
    <li>
      <a href="../articles/ii-modules.html">02 Building `SpaDES` modules</a>
    </li>
    <li>
      <a href="../articles/iii-cache.html">03 Caching `SpaDES` simulations</a>
    </li>
    <li>
      <a href="../articles/iv-advanced.html">04 Advanced `SpaDES` use</a>
    </li>
    <li>
      <a href="../articles/v-automated-testing.html">05 Automated module testing</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PredictiveEcology/SpaDES.core/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert standard module code into an R package</h1>
    <small class="dont-index">Source: <a href="https://github.com/PredictiveEcology/SpaDES.core/blob/main/R/convertToPackage.R" class="external-link"><code>R/convertToPackage.R</code></a></small>
    <div class="hidden name"><code>convertToPackage.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><em>EXPERIMENTAL – USE WITH CAUTION</em>. This function attempts to convert a
SpaDES module to the closest rendition of the same functionality, but in an
R package. The main change is that instead of <code>SpaDES.core</code> parsing the functions
using custom parsing tools, it will use <code><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">pkgload::load_all</a></code> on the package functions.
These</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">convertToPackage</span><span class="op">(</span></span>
<span>  module <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"spades.modulePath"</span><span class="op">)</span>,</span>
<span>  buildDocuments <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-module">module<a class="anchor" aria-label="anchor" href="#arg-module"></a></dt>
<dd><p>Character string of module name, without path</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Character string of <code>modulePath</code>. Defaults to  <code>getOption("spades.modulePath")</code>.</p></dd>


<dt id="arg-builddocuments">buildDocuments<a class="anchor" aria-label="anchor" href="#arg-builddocuments"></a></dt>
<dd><p>A logical. If <code>TRUE</code>, the default, then the documentation
will be built, if any exists, using <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenise</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Invoked for its side effects. There will be a new or modified
<code>DESCRIPTION</code> file in the root directory of the module. Any functions that
were in the main module script (i.e., the .R file whose filename is the name of
the module and is in the root directory of the module) will be moved to individual
<code>.R</code> files in the <code>R</code> folder. Any function with a dot prefix will have the
dot removed in its respective filename, but the function name is unaffected.</p>
<p>Currently, <code>SpaDES.core</code> does not install the package under any circumstances.
It will load it via <code>pkgdown::load_all</code>, and optionally (<code>option("spades.moduleDocument" = TRUE)</code>)
build documentation via <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenise</a></code> within the <code>simInit</code> call.
This means that any modifications to source code
will be read in during the <code>simInit</code> call, as is the practice when a module
is not a package.</p>
<p>invoked for the side effect of converting a module to a package</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><code>convertToPackage</code> will:</p><ol><li><p>move any functions that were defined within the main module file
(<code>moduleName.R</code>) into the R folder, with the same name, but ending with <code>Fns.R</code>;</p></li>
<li><p>keep the <code>defineModule(...)</code> function call with all the metadata in
the same file, <code>moduleName.R</code>, but with all other content removed,
i.e., only the <code>defineModule(...)</code> will be here.</p></li>
<li><p>build documentation from all the <span class="pkg">roxygen2</span> tags</p></li>
<li><p>places one <span class="pkg">roxygen2</span> tag, <code>@export</code> in front of the <code>doEvent.moduleName</code>
function, so that the function can be found by <code>SpaDES.core</code></p></li>
<li><p>All other functions will be kept "private", i.e., not exported, unless
the user manually adds <code>@export</code>, as per a normal package</p></li>
<li><p>will make a <code>DESCRIPTION</code> file from the SpaDES module metadata</p></li>
<li><p>will make a <code>NAMESPACE</code> file from the <span class="pkg">roxygen2</span> tags (e.g., <code>@export</code>)</p></li>
</ol><p>A user can continue to use the module code as before, i.e., by editing it and
putting <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> etc. It will be parsed during <code>simInit</code>. Because the functions
are "in a package", they are automatically namespaced with each other, so that
when you want to use a function from that package, there is no need to put a
prefix with the package name.</p>
<p>This function does not install anything (e.g., <code>devtools::install</code>). After
running this function, <code>simInit</code> will automatically detect that this is now
a package and will load the functions (via <code><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">pkgload::load_all</a></code>) from the source files.
This will have the effect that it emulates the "non-package" behaviour of a
SpaDES module exactly. After running this function, current tests show no
impact on module behaviour, other than event-level and module-level Caching will show
changes and will be rerun. Function-level Caching appears unaffected.
In other words, this should cause no changes to running the module code via
<code>simInit</code> and <code>spades</code>.</p>
<p>This function will create
and fill a minimal <code>DESCRIPTION</code> file. This will leave the <code>defineModule</code>
function call as the only code in the main module file. This <code>defineModule</code>
and a <code>doEvent.xxx</code> are the only 2 elements that are required for an R
package to be considered a SpaDES module. With these changes, the module should
still function normally, but will be able to act like an
R package, e.g., for writing function documentation with <code>roxygen2</code>,
using the <code>testthat</code> infrastructure, etc.</p>
<p>This function is intended to be run once for a module that was created using
the "standard" SpaDES module structure (e.g., from a <code>newModule</code> call). There
is currently no way to "revert" the changes from R (though it can be done using
version control utilities if all files are under version control, e.g., GitHub).
Currently <code>SpaDES.core</code> identifies a module as being a package if it has
a <code>DESCRIPTION</code> file, or if it has been installed to the <code><a href="https://rdrr.io/r/base/libPaths.html" class="external-link">.libPaths()</a></code>
e.g., via <code>devtools::install</code> or the like. So one can simply remove the
package from <code>.libPaths</code> and delete the <code>DESCRIPTION</code> file and
<code>SpaDES.core</code> will treat it as a normal module.</p>
    </div>
    <div id="reverting">
    <h2>Reverting</h2>


<p>Currently, this is not a reversible process. We recommend trying one module at
a time, running your code. If all seems to work, then great. Commit the changes.
If things don't seem to work, then revert the changes and continue on as before.
Ideally, file a bug report on the <code>SpaDES.core</code> GitHub.com pages.</p>
<p>Currently</p>
    </div>
    <div id="exported-functions">
    <h2>Exported functions</h2>



<p>The only function that will be exported by default is the <code>doEvent.xxx</code>,
where <code>xxx</code> is the module name. If any other module is to be exported, it must
be explicitly exported with e.g., <code>@export</code>, and then building the <code>NAMESPACE</code>
file, e.g., via <code>devtools::document(moduleRootPath)</code>. NOTE: as long as all
the functions are being used inside each other, and they all can be traced back
to a call in <code>doEvent.xxx</code>, then there is no need to export anything else.</p>
    </div>
    <div id="description">
    <h2>DESCRIPTION</h2>



<p>The <code>DESCRIPTION</code> file that is created (destroying any existing <code>DESCRIPTION</code>
file) with this function will have
several elements that a user may wish to change. Notably, all packages that were
in <code>reqdPkgs</code> in the SpaDES module metadata will be in the <code>Imports</code>
section of the <code>DESCRIPTION</code>. To accommodate the need to see these functions,
a new R script, <code>imports.R</code> will be created with <code>@import</code> for each
package in <code>reqdPkgs</code> of the module metadata. However, if a module already has used
<code>@importFrom</code> for importing a function from a package, then the generic
<code>@import</code> will be omitted for that (those) package(s).
So, a user should likely follow standard R package
best practices and use <code>@importFrom</code> to identify the specific functions that
are required within external packages, thereby limiting function name collisions
(and the warnings that come with them).</p>
<p>Other elements of a standard <code>DESCRIPTION</code> file that will be missing or possibly
inappropriately short are <code>Title</code>, <code>Description</code>, <code>URL</code>,
<code>BugReports</code>.</p>
    </div>
    <div id="installing-as-a-package">
    <h2>Installing as a package</h2>



<p>There is no need to "install" the source code as a package because <code>simInit</code>
will load it on the fly. But, there may be reasons to install it, e.g., to have
access to individual functions, help manual, running tests etc. To do this,
simply use the <code>devtools::install(pathToModuleRoot)</code>. Even if it is installed,
<code>simInit</code> will nevertheless run <code><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">pkgload::load_all</a></code> to ensure the
<code>spades</code> call will be using the current source code.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"pkgload"</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">tmpdir</span> <span class="op">&lt;-</span> <span class="fu">tempdir2</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="newModule.html">newModule</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="va">tmpdir</span>, open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">convertToPackage</span><span class="op">(</span><span class="st">"test"</span>, path <span class="op">=</span> <span class="va">tmpdir</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">pkgload</span><span class="fu">::</span><span class="fu"><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmpdir</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">pkgload</span><span class="fu">::</span><span class="fu"><a href="https://pkgload.r-lib.org/reference/unload.html" class="external-link">unload</a></span><span class="op">(</span><span class="st">"test"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00; font-weight: bold;">New module</span><span style="font-weight: bold;"> </span><span style="color: #BBBB00; font-weight: bold;">test</span><span style="font-weight: bold;"> </span><span style="color: #00BB00; font-weight: bold;">created at</span><span style="font-weight: bold;"> </span><span style="color: #BBBB00; font-weight: bold;">/tmp/RtmpiqS17z/reproducible/jq0XUoY9</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">* edit module code in</span> <span style="color: #BBBB00;">test.R</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">* write tests for your module code in</span> <span style="color: #BBBB00;">tests/</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">* describe and document your module in</span> <span style="color: #BBBB00;">test.Rmd</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">* tell others how to cite your module by editing</span> <span style="color: #BBBB00;">citation.bib</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">* choose a license for your module; see</span> <span style="color: #BBBB00;">LICENSE.md</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Main module file is: /tmp/RtmpiqS17z/reproducible/jq0XUoY9/test/test.R</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Main documentation file is: /tmp/RtmpiqS17z/reproducible/jq0XUoY9/test/test.Rmd</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> New/updated DESCRIPTION file is: /tmp/RtmpiqS17z/reproducible/jq0XUoY9/test/DESCRIPTION</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building documentation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> First time using roxygen2. Upgrading automatically...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting `RoxygenNote` to "7.3.2"</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">test</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">NAMESPACE</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">test</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

