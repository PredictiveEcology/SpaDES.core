<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-CA"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Alternative way to define events in SpaDES.core — defineEvent • SpaDES.core</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Alternative way to define events in SpaDES.core — defineEvent"><meta property="og:description" content="There are two ways to define what occurs during an event: defining a function
called doEvent.moduleName, where moduleName is the actual module name.
This approach is the original approach used in SpaDES.core, and it must have an
explicit switch statement branching on eventType.
The newer approach (still experimental) uses defineEvent().
Instead of creating, doEvent.moduleName(), it creates one function
for each event, each with the name doEvent.moduleName.eventName.
This may be a little bit cleaner, but both with still work."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-58633549-6"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58633549-6');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.core</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/i-introduction.html">01 Introduction to `SpaDES`</a>
    </li>
    <li>
      <a href="../articles/ii-modules.html">02 Building `SpaDES` modules</a>
    </li>
    <li>
      <a href="../articles/iii-cache.html">03 Caching `SpaDES` simulations</a>
    </li>
    <li>
      <a href="../articles/iv-advanced.html">04 Advanced `SpaDES` use</a>
    </li>
    <li>
      <a href="../articles/v-automated-testing.html">05 Automated module testing</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PredictiveEcology/SpaDES.core/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Alternative way to define events in SpaDES.core</h1>
    <small class="dont-index">Source: <a href="https://github.com/PredictiveEcology/SpaDES.core/blob/v2.1.8/R/simulation-spades.R" class="external-link"><code>R/simulation-spades.R</code></a></small>
    <div class="hidden name"><code>defineEvent.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>There are two ways to define what occurs during an event: defining a function
called <code>doEvent.moduleName</code>, where <code>moduleName</code> is the actual module name.
This approach is the original approach used in SpaDES.core, and it must have an
explicit <code>switch</code> statement branching on <code>eventType</code>.
The newer approach (still experimental) uses <code>defineEvent()</code>.
Instead of creating, <code>doEvent.moduleName()</code>, it creates one function
for each event, each with the name <code>doEvent.moduleName.eventName</code>.
This may be a little bit cleaner, but both with still work.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">defineEvent</span><span class="op">(</span></span>
<span>  <span class="va">sim</span>,</span>
<span>  eventName <span class="op">=</span> <span class="st">"init"</span>,</span>
<span>  <span class="va">code</span>,</span>
<span>  moduleName <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-sim">sim<a class="anchor" aria-label="anchor" href="#arg-sim"></a></dt>
<dd><p>A <code>simList</code></p></dd>


<dt id="arg-eventname">eventName<a class="anchor" aria-label="anchor" href="#arg-eventname"></a></dt>
<dd><p>Character string of the desired event name to define. Default is "init"</p></dd>


<dt id="arg-code">code<a class="anchor" aria-label="anchor" href="#arg-code"></a></dt>
<dd><p>An expression that defines the code to execute during the event. This will
be captured, and pasted into a new function (<code>doEvent.moduleName.eventName</code>),
remaining unevaluated until that new function is called.</p></dd>


<dt id="arg-modulename">moduleName<a class="anchor" aria-label="anchor" href="#arg-modulename"></a></dt>
<dd><p>Character string of the name of the module. If this function is
used within a module, then it will try to find the module name.</p></dd>


<dt id="arg-envir">envir<a class="anchor" aria-label="anchor" href="#arg-envir"></a></dt>
<dd><p>An optional environment to specify where to put the resulting function.
The default will place a function called <code>doEvent.moduleName.eventName</code> in the
module function location, i.e., <code>sim$.mods[[moduleName]]</code>. However, if this
location does not exist, then it will place it in the <code><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame()</a></code>, with a message.
Normally, especially, if used within SpaDES module code, this should be left missing.</p></dd>

</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="defineModule.html">defineModule()</a></code>, <code><a href="simInit.html">simInit()</a></code>, <code><a href="scheduleEvent.html">scheduleEvent()</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="simInit.html">simInit</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   options(</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     reproducible.cachePath = '/tmp/RtmpXxjf07/reproducible/cache'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     spades.inputPath = '/tmp/RtmpXxjf07/SpaDES/inputs'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     spades.outputPath = '/tmp/RtmpXxjf07/SpaDES/outputs'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     spades.modulePath = '/tmp/RtmpXxjf07/SpaDES/modules'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     spades.scratchPath = '/tmp/RtmpXxjf07/SpaDES/scratch'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   )</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Sep18 15:23:57 simInit Using setDTthreads(1). To change: 'options(spades.DTthreads = X)'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Elapsed time for simInit: 0.02552867 secs</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># these put the functions in the parent.frame() which is .GlobalEnv for an interactive user</span></span></span>
<span class="r-in"><span><span class="fu">defineEvent</span><span class="op">(</span><span class="va">sim</span>, <span class="st">"init"</span>, moduleName <span class="op">=</span> <span class="st">"thisTestModule"</span>, code <span class="op">=</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu">Init</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="co"># initialize</span></span></span>
<span class="r-in"><span>  <span class="co"># Now schedule some different event for "current time", i.e., will</span></span></span>
<span class="r-in"><span>  <span class="co">#   be put in the event queue to run *after* this current event is finished</span></span></span>
<span class="r-in"><span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="scheduleEvent.html">scheduleEvent</a></span><span class="op">(</span><span class="va">sim</span>, <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span>, <span class="st">"thisTestModule"</span>, <span class="st">"grow"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span>, envir <span class="op">=</span> <span class="fu"><a href="simList-accessors-envir.html">envir</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">defineEvent</span><span class="op">(</span><span class="va">sim</span>, <span class="st">"grow"</span>, moduleName <span class="op">=</span> <span class="st">"thisTestModule"</span>, code <span class="op">=</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu">grow</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="co"># grow</span></span></span>
<span class="r-in"><span>  <span class="co"># Now schedule this same event for "current time plus 1", i.e., a "loop"</span></span></span>
<span class="r-in"><span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="scheduleEvent.html">scheduleEvent</a></span><span class="op">(</span><span class="va">sim</span>, <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"thisTestModule"</span>, <span class="st">"grow"</span><span class="op">)</span> <span class="co"># for "time plus 1"</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Init</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">sim</span><span class="op">$</span><span class="va">messageToWorld</span> <span class="op">&lt;-</span> <span class="st">"Now the sim has an object in it that can be accessed"</span></span></span>
<span class="r-in"><span>  <span class="va">sim</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># initializes the size object --&gt; this can be anything, Raster, list, whatever</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">messageToWorld</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span>   <span class="co"># returns all the things you added to sim as they are in the simList</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">grow</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">sim</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">size</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># increments the size</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">size</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># schedule that first "init" event</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="scheduleEvent.html">scheduleEvent</a></span><span class="op">(</span><span class="va">sim</span>, <span class="fl">0</span>, <span class="st">"thisTestModule"</span>, <span class="st">"init"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Look at event queue</span></span></span>
<span class="r-in"><span><span class="fu"><a href="simList-accessors-events.html">events</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="co"># shows the "init" we just added</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    eventTime     moduleName eventType eventPriority</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;num&gt;         &lt;char&gt;    &lt;char&gt;         &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:         0     checkpoint      init             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:         0           save      init             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:         0       progress      init             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:         0           load      init             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:         0 thisTestModule      init             5</span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span>  <span class="co"># this is skipped when running in automated tests; it is fine in interactive use</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="spades.html">spades</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Sep18 15:23:57 simInit Using setDTthreads(1). To change: 'options(spades.DTthreads = X)'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Sep18 15:23:57 chckpn:<span style="color: #00BB00;">init</span> <span style="color: #00BB00;">total elpsd: 0.027 secs | 0 checkpoint init 0</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Sep18 15:23:57 save  :<span style="color: #00BB00;">init</span> <span style="color: #00BB00;">total elpsd: 0.029 secs | 0 save init 0</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Sep18 15:23:57 prgrss:<span style="color: #00BB00;">init</span> <span style="color: #00BB00;">total elpsd: 0.031 secs | 0 progress init 0</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Sep18 15:23:57 load  :<span style="color: #00BB00;">init</span> <span style="color: #00BB00;">total elpsd: 0.033 secs | 0 load init 0</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Sep18 15:23:57 thsTst:<span style="color: #00BB00;">init</span> <span style="color: #00BB00;">total elpsd: 0.035 secs | 0 thisTestModule init 5</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in Init(sim):</span> could not find function "Init"</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB00BB;">Because of an interrupted spades call, the sim object at the time of interruption was saved in</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">SpaDES.core:::savedSimEnv()$.sim</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB00BB;">It will be deleted on next call to spades().</span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

